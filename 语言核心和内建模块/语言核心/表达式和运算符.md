# 表达式和运算符

* Python 对`表达式求值`并产生一个值。

* 最简单的表达式是`字面量`和`标识符`。

* 多个`子表达式`(使用操作符和/或定界符连接)可以`构建`其他`表达式`。

| 运算符 | 描述 | 结合性 |
| :-: | :-: | :-: |
| {key: expr, ...} | 创建字典 | 无结合性 |
| {expr, ...} | 创建 Set | 无结合性 |
| [expr, ...] | 创建列表 | 无结合性 |
| (expr, ...) | 创建元组或仅仅只是括起来 | 无结合性 |
| f(expr, ...) | 函数调用 | 从左到右 |
| x\[index:index\] | 切片 | 从左到右 |
| x\[index\] | 索引 | 从左到右 |
| x.attr | 属性引用 | 从左到右 |
| x ** y | 乘幂(x 的 y 次方) | 从右到左 |
| ~x | 按位取反 | 无结合性 |
| +x, -x | 一元 +/- | 无结合性 |
| x * y, x / y, x // y, x % y | 乘, 除, 截断除, 求余 | 从左到右 |
| x + y, x - y | 加, 减 | 从左到右 |
| x << y, x >> y | 按位左移, 按位右移 | 从左到右 |
| x & y | 按位与 | 从左到右 |
| x ^ y | 按位异或 | 从左到右 |
| x \| y | 按位或 | 从左到右 |
| x < y, x <= y, x > y, x >= y, x <> y(v2), x != y, x == y | 比较运算符(返回 bool 类型值) | 无结合性 |
| x is y, x is not y | 身份测试 | 无结合性 |
| x in y, x not in y | 关系测试 | 无结合性 |
| not x | 布尔取反 | 无结合性 |
| x and y | 布尔与 | 从左到右 |
| x or y | 布尔或 | 从左到右 |
| x if expr else y | 三元运算符 | 无结合性 |
| lambda arg, ...: expr | 匿名简单函数(lambda 表达式) | 无结合性 |

* 上表说明：
  1. 运算符优先级从高到低；
  2. expr，key，f，index，x 和 y 表示任何表达式；
  3. attr 和 arg 表示任何标识符；
  4. ... 表示逗号连接零个或多个重复的相同形式。这些情况下，`尾部`的`逗号`都是`可选`的且`无害`的。

## 链式比较

* 链式比较`隐含`了`逻辑与`。

```python
a < b <= c < d
# 等价于
a < b and b <= c and c < d
```

* 链式比较`更具可读性`，且每个`子表达式`最多被`求值一次`。

## 短路运算符

* `and` 和 `or` 运算符是`短路`运算符。其`右边`的`运算数`，只有在`需要被求值`时，`才`会被`求值`。

```python
x and y
# 先求值 x。
# 当 x 为 false 时，结果是 x，y 不被求值。
# 当 x 为 true 时，结果是 y，y 被求值。
x or y
# 先求值 x。
# 当 x 为 false 时，结果是 y，y 被求值。
# 当 x 为 true 时，结果是 x，y 不被求值。
```

* and 和 or 具有短路特性。`其他运算符`都`不具有短路特性`，其他运算符会在`运算前求值所有的运算数`。

* and 和 or 的`运算数不必一定是布尔值`，也就是可以广泛应用它们，而`非一定`需要`布尔上下文`。

* and 和 or 的短路特性让`左运算数充当了右运算数的守卫`。

### 三元运算符

* `三元运算符` `if/else` 也是一个`短路运算符`。

* `whentrue if condition else whenfalse`。`whentrue`，`whenfalse` 和 `condition` 中的每一个都是`任意表达式`。 `condition` 首先被`求值`，为 `true` 时，结果为 `whentrue` 的`求值`结果，`whenfalse` `不`被`求值`。为 `false` 时，结果为 `whenfalse` 的`求值`结果，`whentrue` `不`被`求值`。根据 `condition` 的`真值`，仅`求值`子表达式 `whentrue` 和 `whenfalse` 之`一`。

* 三元运算符`整个表达式`可能会看起来`比较乱`。所以推荐的风格是总是对`整个表达式加上括号`，`子表达式较复杂时也要加上括号`。
